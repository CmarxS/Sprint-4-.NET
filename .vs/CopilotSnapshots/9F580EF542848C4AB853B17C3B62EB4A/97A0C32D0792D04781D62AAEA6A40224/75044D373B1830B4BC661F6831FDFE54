using System.Net;
using System.Net.Http.Json;
using Microsoft.AspNetCore.Mvc.Testing;
using Xunit;

namespace MottoMap.Tests.Integration
{
    public class HealthCheckIntegrationTests : IClassFixture<WebApplicationFactory<Program>>
    {
        private readonly HttpClient _client;

 public HealthCheckIntegrationTests(WebApplicationFactory<Program> factory)
  {
            _client = factory.CreateClient();
     }

[Fact]
public async Task Health_Endpoint_ReturnsHealthy()
        {
          // Act
  var response = await _client.GetAsync("/health");

       // Assert
       response.EnsureSuccessStatusCode();
    Assert.Equal(HttpStatusCode.OK, response.StatusCode);
  
      var content = await response.Content.ReadAsStringAsync();
     Assert.Contains("Healthy", content);
        }

[Fact]
public async Task HealthController_GetHealth_ReturnsOk()
        {
       // Act
       var response = await _client.GetAsync("/api/v1/health");

  // Assert (Pode retornar 401 se API Key estiver ativa, então verificamos ambos)
   Assert.True(
       response.StatusCode == HttpStatusCode.OK || 
    response.StatusCode == HttpStatusCode.Unauthorized
     );
        }

 [Fact]
        public async Task Swagger_Endpoint_IsAccessible()
      {
  // Act
var response = await _client.GetAsync("/swagger/index.html");

     // Assert
       response.EnsureSuccessStatusCode();
      Assert.Equal(HttpStatusCode.OK, response.StatusCode);
      }
    }
}
